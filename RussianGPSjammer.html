<!-- Wayne Metcalf 2024 -->
<!-- __      __  _____ _____.___._______  ___________-->
<!--/  \    /  \/  _  \\__  |   |\      \ \_   _____/-->
<!--\   \/\/   /  /_\  \/   |   |/   |   \ |    __)_ -->
<!-- \        /    |    \____   /    |    \|        \-->
<!--  \__/\  /\____|__  / ______\____|__  /_______  /-->
<!--       \/         \/\/              \/    2024\/ -->
<!DOCTYPE html>
<html>
<head>
    <title>CSV to Google Map Heatmap</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=API-KEY-HERE&libraries=visualization"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <input type="file" id="csv-input" multiple>
    <button onclick="parseCSV()">Parse CSV</button>
    <div id="map" style="height: 500px; width: 100%;"></div>
    <p>Wayne Metcalf 2024</p>
    <script>
        var map, heatmap;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 2,
                center: {lat: -57.33968, lng: 22.484838},
                mapTypeId: 'terrain'
            });

            heatmap = new google.maps.visualization.HeatmapLayer({
                data: [],
                map: map
            });
        }

        function parseCSV() {
            var files = document.getElementById('csv-input').files;
            var heatmapData = [];
            var tolerance = 0.1; // Tolerance value (10%)
            for (var i = 0; i < files.length; i++) {
                Papa.parse(files[i], {
                    header: false,
                    dynamicTyping: true,
                    complete: function(results) {
                        results.data.forEach(function(item) {
                            if (!isNaN(item[0]) && !isNaN(item[1]) && !isNaN(item[2])) {
                                var latLng = new google.maps.LatLng(item[0], item[1]);
                                var radioHorizon = item[2] * (1 + tolerance); // Add tolerance to the radio horizon
                                // Create a circle with the radio horizon as the radius
                                var circle = new google.maps.Circle({
                                    center: latLng,
                                    radius: radioHorizon * 1000, // Convert to meters
                                    map: map,
                                    visible: false // Hide the circle
                                });
                                // Get the bounds of the circle
                                var bounds = circle.getBounds();
                                // For each point in the heatmap data
                                for (var j = 0; j < heatmapData.length; j++) {
                                    // If the point is within the bounds of the circle
                                    if (bounds.contains(heatmapData[j].location)) {
                                        // Increase the weight of the point
                                        heatmapData[j].weight++;
                                    }
                                }
                                // Add the center of the circle to the heatmap data
                                heatmapData.push({location: latLng, weight: 1});
                                // Remove the circle from the map
                                circle.setMap(null);
                            }
                        });
                        heatmap.setData(heatmapData);
                    }
                });
            }
        }

        window.onload = initMap;
    </script>
</body>
</html>

  
